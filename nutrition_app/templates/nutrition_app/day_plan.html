{% extends 'nutrition_app/base.html' %}
{% load static %}

{% block content %}
<div class="container py-5">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h2 class="fw-bold text-success mb-1">{{ day_name }}</h2>
                    <p class="text-muted mb-0">Детальный план питания</p>
                </div>
                <a href="{% url 'week_plan' %}" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left me-1"></i>Назад к неделе
                </a>
            </div>
        </div>
    </div>

    <!-- Summary Card -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="nutrition-facts">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <h5 class="fw-bold text-success">
                            <i class="bi bi-graph-up me-2"></i>Общая информация
                        </h5>
                        <p class="mb-2">
                            <strong>Суточная норма:</strong> {{ daily_calories }} ккал<br>
                            <strong>Фактически:</strong> {{ total_calories }} ккал<br>
                            <strong>Отклонение:</strong> 
                            <span class="badge {% if deviation <= 0 %}bg-success{% else %}bg-warning{% endif %}">
                                {{ deviation }} ккал
                            </span>
                        </p>
                    </div>
                    <div class="col-md-6 text-md-end">
                        <div class="progress" style="height: 20px;">
                            <div class="progress-bar {% if percentage <= 100 %}bg-success{% else %}bg-warning{% endif %}" 
                                 style="width: {% if percentage > 100 %}100{% else %}{{ percentage|floatformat:0 }}{% endif %}%">
                                {{ percentage|floatformat:0 }}%
                            </div>
                        </div>
                        <small class="text-muted">Выполнение суточной нормы</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Meals -->
    <div class="row g-4">
        <!-- Breakfast -->
        <div class="col-12">
            <div class="nutri-card h-100">
                <div class="card-header bg-warning bg-opacity-10 d-flex justify-content-between align-items-center">
                    <h4 class="mb-0 text-warning">
                        <i class="bi bi-sun me-2"></i>Завтрак
                    </h4>
                    <span class="badge bg-warning">{{ breakfast.calories }} ккал</span>
                </div>
                <div class="card-body">
                    <div class="row align-items-stretch">
                        <div class="col-md-3">
                            <div class="meal-image-container h-100">
                                {% if breakfast.image %}
                                    <img src="{{ breakfast.image.url }}" alt="{{ breakfast.name }}" 
                                         class="meal-image-fixed w-100">
                                {% else %}
                                    <div class="meal-image-placeholder-fixed h-100 d-flex align-items-center justify-content-center">
                                        <i class="bi bi-cup-hot text-muted" style="font-size: 3rem;"></i>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-9">
                            <div class="d-flex flex-column h-100">
                                <div class="flex-grow-1">
                                    <h3 class="text-success mb-2">
                                        {% if breakfast.calories > 0 %}
                                        <a href="{% url 'recipe_detail' breakfast.id %}" class="text-decoration-none text-success">
                                            {{ breakfast.name }}
                                        </a>
                                        {% else %}
                                        <span class="text-success">{{ breakfast.name }}</span>
                                        {% endif %}
                                    </h3>
                                    {% if breakfast.calories > 0 %}
                                    <div class="mb-3">
                                        <span class="badge bg-danger me-1 mb-1">{{ breakfast.protein }}г белка</span>
                                        <span class="badge bg-warning me-1 mb-1">{{ breakfast.fat }}г жиров</span>
                                        <span class="badge bg-info me-1 mb-1">{{ breakfast.carbs }}г углеводов</span>
                                        <span class="badge bg-secondary me-1 mb-1">{{ breakfast.cooking_time }} мин</span>
                                        <span class="badge {% if breakfast.difficulty == 'easy' %}bg-success{% elif breakfast.difficulty == 'medium' %}bg-warning{% else %}bg-danger{% endif %} mb-1">
                                            {% if breakfast.difficulty == 'easy' %}Легко{% elif breakfast.difficulty == 'medium' %}Средне{% else %}Сложно{% endif %}
                                        </span>
                                    </div>
                                    {% else %}
                                    <div class="alert alert-warning mb-0">
                                        <i class="bi bi-exclamation-triangle me-2"></i>
                                        Этот рецепт временно недоступен
                                    </div>
                                    {% endif %}
                                </div>
                                {% if breakfast.calories > 0 %}
                                <div class="mt-auto pt-3">
                                    <a href="{% url 'recipe_detail' breakfast.id %}" class="btn btn-nutri-primary">
                                        <i class="bi bi-arrow-right me-1"></i>Подробнее
                                    </a>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Lunch -->
        <div class="col-12">
            <div class="nutri-card h-100">
                <div class="card-header bg-success bg-opacity-10 d-flex justify-content-between align-items-center">
                    <h4 class="mb-0 text-success">
                        <i class="bi bi-sun-fill me-2"></i>Обед
                    </h4>
                    <span class="badge bg-success">{{ lunch.calories }} ккал</span>
                </div>
                <div class="card-body">
                    <div class="row align-items-stretch">
                        <div class="col-md-3">
                            <div class="meal-image-container h-100">
                                {% if lunch.image %}
                                    <img src="{{ lunch.image.url }}" alt="{{ lunch.name }}" 
                                         class="meal-image-fixed w-100">
                                {% else %}
                                    <div class="meal-image-placeholder-fixed h-100 d-flex align-items-center justify-content-center">
                                        <i class="bi bi-egg-fried text-muted" style="font-size: 3rem;"></i>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-9">
                            <div class="d-flex flex-column h-100">
                                <div class="flex-grow-1">
                                    <h3 class="text-success mb-2">
                                        {% if lunch.calories > 0 %}
                                        <a href="{% url 'recipe_detail' lunch.id %}" class="text-decoration-none text-success">
                                            {{ lunch.name }}
                                        </a>
                                        {% else %}
                                        <span class="text-success">{{ lunch.name }}</span>
                                        {% endif %}
                                    </h3>
                                    {% if lunch.calories > 0 %}
                                    <div class="mb-3">
                                        <span class="badge bg-danger me-1 mb-1">{{ lunch.protein }}г белка</span>
                                        <span class="badge bg-warning me-1 mb-1">{{ lunch.fat }}г жиров</span>
                                        <span class="badge bg-info me-1 mb-1">{{ lunch.carbs }}г углеводов</span>
                                        <span class="badge bg-secondary me-1 mb-1">{{ lunch.cooking_time }} мин</span>
                                        <span class="badge {% if lunch.difficulty == 'easy' %}bg-success{% elif lunch.difficulty == 'medium' %}bg-warning{% else %}bg-danger{% endif %} mb-1">
                                            {% if lunch.difficulty == 'easy' %}Легко{% elif lunch.difficulty == 'medium' %}Средне{% else %}Сложно{% endif %}
                                        </span>
                                    </div>
                                    {% else %}
                                    <div class="alert alert-warning mb-0">
                                        <i class="bi bi-exclamation-triangle me-2"></i>
                                        Этот рецепт временно недоступен
                                    </div>
                                    {% endif %}
                                </div>
                                {% if lunch.calories > 0 %}
                                <div class="mt-auto pt-3">
                                    <a href="{% url 'recipe_detail' lunch.id %}" class="btn btn-nutri-primary">
                                        <i class="bi bi-arrow-right me-1"></i>Подробнее
                                    </a>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Snack -->
        <div class="col-12">
            <div class="nutri-card h-100">
                <div class="card-header bg-info bg-opacity-10 d-flex justify-content-between align-items-center">
                    <h4 class="mb-0 text-info">
                        <i class="bi bi-cup-straw me-2"></i>Перекус
                    </h4>
                    <span class="badge bg-info">{{ snack.calories }} ккал</span>
                </div>
                <div class="card-body">
                    <div class="row align-items-stretch">
                        <div class="col-md-3">
                            <div class="meal-image-container h-100">
                                {% if snack.image %}
                                    <img src="{{ snack.image.url }}" alt="{{ snack.name }}" 
                                         class="meal-image-fixed w-100">
                                {% else %}
                                    <div class="meal-image-placeholder-fixed h-100 d-flex align-items-center justify-content-center">
                                        <i class="bi bi-cup-straw text-muted" style="font-size: 3rem;"></i>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-9">
                            <div class="d-flex flex-column h-100">
                                <div class="flex-grow-1">
                                    <h3 class="text-success mb-2">
                                        {% if snack.calories > 0 %}
                                        <a href="{% url 'recipe_detail' snack.id %}" class="text-decoration-none text-success">
                                            {{ snack.name }}
                                        </a>
                                        {% else %}
                                        <span class="text-success">{{ snack.name }}</span>
                                        {% endif %}
                                    </h3>
                                    {% if snack.calories > 0 %}
                                    <div class="mb-3">
                                        <span class="badge bg-danger me-1 mb-1">{{ snack.protein }}г белка</span>
                                        <span class="badge bg-warning me-1 mb-1">{{ snack.fat }}г жиров</span>
                                        <span class="badge bg-info me-1 mb-1">{{ snack.carbs }}г углеводов</span>
                                        <span class="badge bg-secondary me-1 mb-1">{{ snack.cooking_time }} мин</span>
                                        <span class="badge {% if snack.difficulty == 'easy' %}bg-success{% elif snack.difficulty == 'medium' %}bg-warning{% else %}bg-danger{% endif %} mb-1">
                                            {% if snack.difficulty == 'easy' %}Легко{% elif snack.difficulty == 'medium' %}Средне{% else %}Сложно{% endif %}
                                        </span>
                                    </div>
                                    {% else %}
                                    <div class="alert alert-warning mb-0">
                                        <i class="bi bi-exclamation-triangle me-2"></i>
                                        Этот рецепт временно недоступен
                                    </div>
                                    {% endif %}
                                </div>
                                {% if snack.calories > 0 %}
                                <div class="mt-auto pt-3">
                                    <a href="{% url 'recipe_detail' snack.id %}" class="btn btn-nutri-primary">
                                        <i class="bi bi-arrow-right me-1"></i>Подробнее
                                    </a>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dinner -->
        <div class="col-12">
            <div class="nutri-card h-100">
                <div class="card-header bg-primary bg-opacity-10 d-flex justify-content-between align-items-center">
                    <h4 class="mb-0 text-primary">
                        <i class="bi bi-moon me-2"></i>Ужин
                    </h4>
                    <span class="badge bg-primary">{{ dinner.calories }} ккал</span>
                </div>
                <div class="card-body">
                    <div class="row align-items-stretch">
                        <div class="col-md-3">
                            <div class="meal-image-container h-100">
                                {% if dinner.image %}
                                    <img src="{{ dinner.image.url }}" alt="{{ dinner.name }}" 
                                         class="meal-image-fixed w-100">
                                {% else %}
                                    <div class="meal-image-placeholder-fixed h-100 d-flex align-items-center justify-content-center">
                                        <i class="bi bi-moon-stars text-muted" style="font-size: 3rem;"></i>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-9">
                            <div class="d-flex flex-column h-100">
                                <div class="flex-grow-1">
                                    <h3 class="text-success mb-2">
                                        {% if dinner.calories > 0 %}
                                        <a href="{% url 'recipe_detail' dinner.id %}" class="text-decoration-none text-success">
                                            {{ dinner.name }}
                                        </a>
                                        {% else %}
                                        <span class="text-success">{{ dinner.name }}</span>
                                        {% endif %}
                                    </h3>
                                    {% if dinner.calories > 0 %}
                                    <div class="mb-3">
                                        <span class="badge bg-danger me-1 mb-1">{{ dinner.protein }}г белка</span>
                                        <span class="badge bg-warning me-1 mb-1">{{ dinner.fat }}г жиров</span>
                                        <span class="badge bg-info me-1 mb-1">{{ dinner.carbs }}г углеводов</span>
                                        <span class="badge bg-secondary me-1 mb-1">{{ dinner.cooking_time }} мин</span>
                                        <span class="badge {% if dinner.difficulty == 'easy' %}bg-success{% elif dinner.difficulty == 'medium' %}bg-warning{% else %}bg-danger{% endif %} mb-1">
                                            {% if dinner.difficulty == 'easy' %}Легко{% elif dinner.difficulty == 'medium' %}Средне{% else %}Сложно{% endif %}
                                        </span>
                                    </div>
                                    {% else %}
                                    <div class="alert alert-warning mb-0">
                                        <i class="bi bi-exclamation-triangle me-2"></i>
                                        Этот рецепт временно недоступен
                                    </div>
                                    {% endif %}
                                </div>
                                {% if dinner.calories > 0 %}
                                <div class="mt-auto pt-3">
                                    <a href="{% url 'recipe_detail' dinner.id %}" class="btn btn-nutri-primary">
                                        <i class="bi bi-arrow-right me-1"></i>Подробнее
                                    </a>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <div class="row mt-5">
        <div class="col-12 text-center">
            <a href="{% url 'week_plan' %}" class="btn btn-nutri-outline btn-lg me-3">
                <i class="bi bi-arrow-left me-2"></i>Вернуться к неделе
            </a>
            <button class="btn btn-nutri-primary btn-lg" onclick="window.print()">
                <i class="bi bi-printer me-2"></i>Распечатать день
            </button>
        </div>
    </div>
</div>
{% endblock %}


